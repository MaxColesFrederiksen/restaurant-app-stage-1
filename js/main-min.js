var _this=this;let restaurants,neighborhoods,cuisines;var map,markers=[];document.addEventListener('DOMContentLoaded',()=>{fetchNeighborhoods(),fetchCuisines()}),toggle_map=()=>{document.getElementById('map').style.display='none'===document.getElementById('map').style.display?'block':'none'},swap_map=()=>{'none'===document.getElementById('map').style.display&&(document.getElementById('map').style.display='block',document.getElementById('static_map').style.display='none')},addMapListener=()=>{document.querySelector('.toggle-map').addEventListener('click',function(b){b.preventDefault(),this.classList.toggle('.show-map'),_this.toggle_map()})},fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((a,b)=>{a?console.error(a):(self.neighborhoods=b,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=(a=self.neighborhoods)=>{const b=document.getElementById('neighborhoods-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},fetchCuisines=()=>{DBHelper.fetchCuisines((a,b)=>{a?console.error(a):(self.cuisines=b,fillCuisinesHTML())})},fillCuisinesHTML=(a=self.cuisines)=>{const b=document.getElementById('cuisines-select');a.forEach(c=>{const d=document.createElement('option');d.innerHTML=c,d.value=c,b.append(d)})},window.initMap=()=>{self.map=new google.maps.Map(document.getElementById('map'),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()},updateRestaurants=()=>{const a=document.getElementById('cuisines-select'),b=document.getElementById('neighborhoods-select'),c=a.selectedIndex,d=b.selectedIndex,f=a[c].value,g=b[d].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(f,g,(h,i)=>{h?console.error(h):(resetRestaurants(i),fillRestaurantsHTML())})},resetRestaurants=a=>{self.restaurants=[];const b=document.getElementById('restaurants-list');b.innerHTML='',self.markers.forEach(c=>c.setMap(null)),self.markers=[],self.restaurants=a},fillRestaurantsHTML=(a=self.restaurants)=>{const b=document.getElementById('restaurants-list');a.forEach(c=>{b.append(createRestaurantHTML(c))}),addMarkersToMap(),addFavoriteListener(),addMapListener(),DBHelper.lazyLoadImages(a)},createRestaurantHTML=a=>{const b=document.createElement('li'),c=document.createElement('div');c.className='card';const d=document.createElement('img');d.className+='lazy',d.className+=' restaurant-img',d.src=`/img/placeholder-img.jpg`,d.srcset=`/img_dist/placeholder-img-400-small.jpg 400w, /img_dist/placeholder-img-800-medium.jpg 800w, img_dist/placeholder-img-1600-large.jpg 1600w,`,d.setAttribute('data-src',DBHelper.imageUrlForRestaurant(a)),d.setAttribute('data-srcset',DBHelper.imageSrcsetUrlForRestaurant(a)),d.alt=`Picture from the restaurant called ${a.name}`,c.append(d),b.append(c);const f=document.createElement('h3');f.innerHTML=a.name,c.append(f),b.append(c);const g=document.createElement('div');g.className='line-breaker',c.append(g),b.append(c);const h=document.createElement('p');h.innerHTML=a.neighborhood,c.append(h),b.append(c);const i=document.createElement('p');i.innerHTML=a.address,c.append(i),b.append(c);const j=document.createElement('a');j.innerHTML='View Details',j.href=DBHelper.urlForRestaurant(a),c.append(j),b.append(c);const k=document.createElement('i');return k.className='favorite',k.setAttribute('favorite-restaurant',a.id),'true'==a.is_favorite?k.className+=' favorited':k.className='favorite',c.append(k),b.append(c),b},addMarkersToMap=(a=self.restaurants)=>{a.forEach(b=>{const c=DBHelper.mapMarkerForRestaurant(b,self.map);google.maps.event.addListener(c,'click',()=>{window.location.href=c.url}),self.markers.push(c)})},addFavoriteListener=()=>{const a=document.querySelectorAll('.favorite');a.forEach(function(b){b.addEventListener('click',function(){if(!hasClass(b,'favorited')){let c=b.getAttribute('favorite-restaurant');DBHelper.favoriteRestaurant(c)}else{let c=b.getAttribute('favorite-restaurant');DBHelper.unFavoriteRestaurant(c)}b.classList.toggle('favorited'),console.log(hasClass(b,'favorited'))})})},hasClass=(a,b)=>{return a.className&&new RegExp('(^|\\s)'+b+'(\\s|$)').test(a.className)};